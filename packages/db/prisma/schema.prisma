generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  // In Prisma 7, url/directUrl are configured via prisma.config.ts
  // This block stays minimal here.
}

model SanityCheck {
  id        Int      @id @default(autoincrement())
  message   String
  createdAt DateTime @default(now())
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  stripeAccountId    String? @unique
  subscriptionStatus String? @default("none")

  sessions  Session[]
  tickets   Ticket[]
}

model Session {
  id        String   @id @default(uuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Store as a hash (never store raw session tokens if you later use them)
  tokenHash String   @unique

  createdAt DateTime @default(now())
  expiresAt DateTime
  revokedAt DateTime?

  @@index([userId])
  @@index([expiresAt])
}

enum TicketStatus {
  pending   // created, not yet reviewed/approved
  approved  // client agreed to price/scope
  paid      // payment confirmed (Stripe truth later)
  rejected  // declined / not proceeding
}

model Ticket {
  id        String       @id @default(uuid())
  status    TicketStatus @default(pending)

  // Pricing
  priceCents Int?        // set when freelancer proposes/approves pricing
  currency   String      @default("USD")

  // Evidence (what was captured)
  platform     String    // e.g. "whatsapp", "slack", "email"
  evidenceText String
  evidenceAt   DateTime  // when the message/request happened (client-side timestamp)
  evidenceUrl  String?   // optional deep link / message URL / thread link

  // Optional attachments (later)
  assetUrl   String?     // uploaded screenshot/image reference (later)

  // Ownership + routing (added now for future sanity)
  ownerUserId String
  owner       User       @relation(fields: [ownerUserId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([ownerUserId, createdAt])
  @@index([status, createdAt])
}
